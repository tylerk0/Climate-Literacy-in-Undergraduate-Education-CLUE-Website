<!--
	AUTHORS:     Tyler Kramer, Johnny Duong, Lilly Schmidt, Shan Sindy, Yarely Torres
	FILE:        RequestAccess.html
	DESCRIPTION: This file contains the html code for the RequestAccess webpage.
-->

<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>CLUE: Request Access</title> <!--what we see in the browserâ€™s title bar or page tab-->

		<!--External CSS Stylesheet-->
		<link href="../CLUE.css" type="text/css" rel="stylesheet">
	</head>

	<body>
		<header class="site-header">
			<div class="container site-header__inner">
				<div class="brand">
					<img class="brand__logo" src="../LogosAndBranding/CLUE%20-%20black.png" alt="CLUE logo">
					<h1 class="brand__title">Climate Literacy in Undergraduate Education (CLUE)</h1>
				</div>
				<nav class="site-nav" aria-label="Primary">
					<a href="../CLUE.html">Home</a>
					<a href="../CLUE.html#module">Module Materials</a>
					<a id="unit" href="unit1.html">Unit 1</a>
					<a id="unit" href="unit2.html">Unit 2</a>
					<a id="unit" href="unit3.html">Unit 3</a>
					<a id="unit" href="unit4.html">Unit 4</a>
					<a id="unit" href="unit5.html">Unit 5</a>
					<a id="unit" href="unit6.html">Unit 6</a>
				</nav>
			</div>
		</header>

		<div class="clue-request-page">
			<div class="container">
				<img src="../LogosAndBranding/CLUE%20-%20white.png" alt="CLUE Logo" class="logo" />
				<h1 id="portalTitle">Request Access</h1>

				<div class="toggle-buttons">
					<button id="showRequest">Request Access</button>
					<button id="showCode">Enter Access Code</button>
				</div>

				<!-- REQUEST ACCESS SECTION -->
				<div id="requestSection">
					<p>
						Faculty and teaching assistants can request access to CLUE materials by entering their institutional email below.
					</p>

					<form id="cf-form">
						<input type="email" id="cf-email" name="cf-email" placeholder="name@school.edu" required />
						<input type="text" id="website" name="website" style="display:none" tabindex="-1" autocomplete="off" />
						<button type="submit">Request Access</button>
						<p id="cf-status" class="status"></p>
					</form>
				</div>

				<!-- ENTER ACCESS CODE SECTION -->
				<div id="codeSection" class="hidden">
					<p>Enter your approved access code below to unlock the CLUE materials.</p>

					<input type="password" id="accessInput" placeholder="Enter access code" />
					<button onclick="verifyCode()">Submit</button>
					<p id="status" class="status"></p>

					<div id="downloads" class="downloads hidden">
						<h3>Approved Materials</h3>
						<a href="../LearningOutcomesAndQuestionBank/Question%20Bank.docx" download>Answer Key</a>
					</div>
				</div>
			</div>

			<!-- EmailJS Library -->
			<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

			<script type="text/javascript">
				(function(){
					emailjs.init({
						publicKey: "S0gAoFE1GFAdCoe4-",
					});
				})();
			</script>

			<!-- Combined JS Logic -->
			<script>
				// Toggle sections
				const requestBtn = document.getElementById("showRequest");
				const codeBtn = document.getElementById("showCode");
				const requestSection = document.getElementById("requestSection");
				const codeSection = document.getElementById("codeSection");
				const portalTitle = document.getElementById("portalTitle");

				requestBtn.addEventListener("click", () => {
					if (!requestBtn.disabled) {
						requestSection.classList.remove("hidden");
						codeSection.classList.add("hidden");
						portalTitle.textContent = "Request Access";
					}
				});

				codeBtn.addEventListener("click", () => {
					codeSection.classList.remove("hidden");
					requestSection.classList.add("hidden");
					portalTitle.textContent = "Enter Access Code";
				});

				// EmailJS logic
				const form = document.getElementById("cf-form");
				const emailInput = document.getElementById("cf-email");
				const honeypot = document.getElementById("website");
				const statusEl = document.getElementById("cf-status");

				let openedAt = Date.now();

				function looksLikeEmail(s) {
				  return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(s).trim());
				}

				form.addEventListener("submit", async (e) => {
					e.preventDefault();

					if (honeypot.value.trim() !== "") return;
					if (Date.now() - openedAt < 1200) {
						statusEl.textContent = "Please wait a moment and try again.";
						statusEl.style.color = '#b91c1c';
						return;
					}

					const email = emailInput.value.trim();
					if (!looksLikeEmail(email)) {
						statusEl.textContent = "Please enter a valid institutional email address.";
						statusEl.style.color = '#b91c1c';
						emailInput.focus();
						return;
					}

					statusEl.textContent = "Sending...";
					statusEl.style.color = '#374151';

					try {
						const result = await emailjs.send("service_aoelayf", "template_pi8ottj", { email: email });
						console.log("Email sent:", result.text);
						statusEl.textContent = "Request sent successfully!";
						statusEl.style.color = "#16a34a";
						form.reset();
						openedAt = Date.now();
					} catch (err) {
						console.error("EmailJS error:", err);
						statusEl.textContent = "Error sending request. Please try again later.";
						statusEl.style.color = "#b91c1c";
					}
				});

				// Access Code logic
				const ACCESS_CODE = "MTSU2025";
				const inputCode = document.getElementById("accessInput");
				const status = document.getElementById("status");
				const downloads = document.getElementById("downloads");

				function verifyCode() {
					const value = inputCode.value.trim();
					if (value === ACCESS_CODE) {
						downloads.classList.remove("hidden");
						status.textContent = "Access granted. You may now download the materials.";
						status.style.color = "#16a34a";
						requestSection.classList.add("hidden");
						requestBtn.disabled = true;
						requestBtn.style.opacity = "0.6";
					} else {
						status.textContent = "Invalid access code.";
						status.style.color = "#b91c1c";
					}
				}
			</script>
		</div>
	</body>
</html>
