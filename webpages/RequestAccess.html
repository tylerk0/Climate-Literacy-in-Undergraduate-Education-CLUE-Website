<!--
  AUTHORS: Tyler Kramer, Johnny Duong, Lilly Schmidt, Shan Sindy, Yarely Torres
  FILE:    RequestAccess.html
  PURPOSE: This webpage provides a secure way for faculty or teaching assistants to request access to CLUE materials via EmailJS, or to enter an approved access code to unlock downloadable resources.
-->

<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- basic page info -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CLUE: Request Access</title>

    <!-- link to main external stylesheet -->
    <link href="../CLUE.css" type="text/css" rel="stylesheet">
  </head>

  <body>
    <header class="site-header">
      <div class="container site-header__inner">
        <!-- logo and title -->
        <div class="brand">
          <img class="brand__logo" src="../LogosAndBranding/CLUE%20-%20black.png" alt="CLUE logo">
          <h1 class="brand__title">Climate Literacy in Undergraduate Education (CLUE)</h1>
        </div>

        <!-- navigation bar -->
        <nav class="site-nav" aria-label="Primary">
          <a href="../CLUE.html">Home</a>
          <a href="../CLUE.html#module">Module Materials</a>
          <a id="unit" href="unit1.html">Unit 1</a>
          <a id="unit" href="unit2.html">Unit 2</a>
          <a id="unit" href="unit3.html">Unit 3</a>
          <a id="unit" href="unit4.html">Unit 4</a>
          <a id="unit" href="unit5.html">Unit 5</a>
          <a id="unit" href="unit6.html">Unit 6</a>
        </nav>
      </div>
    </header>

    <!-- MAIN CONTENT AREA: Access request and authentication functionality -->
    <div class="clue-request-page">
      <div class="container">
        <!-- Project logo and section title -->
        <img src="../LogosAndBranding/CLUE%20-%20white.png" alt="CLUE Logo" class="logo" />
        <h1 id="portalTitle">Request Access</h1>

        <!-- REQUEST ACCESS SECTION -->
        <div id="requestSection">
          <p>
            Faculty and teaching assistants can request access to CLUE materials by entering their institutional email below.
          </p>

          <!-- EmailJS form for sending access requests to instructor -->
          <form id="cf-form">
            <!-- email input field (required institutional email) -->
            <input type="email" id="cf-email" name="cf-email" placeholder="name@school.edu" required />

            <!-- hidden honeypot input for spam prevention -->
            <input type="text" id="website" name="website" style="display:none" tabindex="-1" autocomplete="off" />

            <!-- submit button for sending the email -->
            <button type="submit">Request Access</button>

            <!-- status message shown after form submission -->
            <p id="cf-status" class="status"></p>
          </form>
        </div>
      </div>

      <!-- EMAILJS SCRIPT: Enables front-end email sending through EmailJS service -->
      <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

      <script type="text/javascript">
        (function(){
          // initialize EmailJS with the projectâ€™s public key
          emailjs.init({
            publicKey: "8GYMYf_zO1AbC-x7L",
          });
        })();
      </script>

      <!-- MAIN JAVASCRIPT LOGIC: Handles toggling, form submission, and authentication -->
      <script>
        // --- EMAILJS LOGIC FOR REQUEST FORM ---
        const form = document.getElementById("cf-form");
        const emailInput = document.getElementById("cf-email");
        const honeypot = document.getElementById("website");
        const statusEl = document.getElementById("cf-status");

        let openedAt = Date.now(); // used to prevent rapid spam submissions

        // basic email format validation
        function looksLikeEmail(s) {
          return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(s).trim());
        }

        // handle form submission event
        form.addEventListener("submit", async (e) => {
          e.preventDefault();

          // stop if honeypot is filled (spam) or too fast submission
          if (honeypot.value.trim() !== "") return;
          if (Date.now() - openedAt < 1200) {
            statusEl.textContent = "Please wait a moment and try again.";
            statusEl.style.color = '#b91c1c';
            return;
          }

          // validate email before sending
          const email = emailInput.value.trim();
          if (!looksLikeEmail(email)) {
            statusEl.textContent = "Please enter a valid institutional email address.";
            statusEl.style.color = '#b91c1c';
            emailInput.focus();
            return;
          }

          // display sending status
          statusEl.textContent = "Sending...";
          statusEl.style.color = '#374151';

          try {
            // send email using EmailJS service and configured template
            const result = await emailjs.send("service_ixz6wxq", "template_j49syug", { email: email });
            console.log("Email sent:", result.text);

            // update success message
            statusEl.textContent = "Request sent successfully!";
            statusEl.style.color = "#16a34a";
            form.reset();
            openedAt = Date.now();
          } catch (err) {
            // handle any EmailJS errors
            console.error("EmailJS error:", err);
            statusEl.textContent = "Error sending request. Please try again later.";
            statusEl.style.color = "#b91c1c";
          }
        });
      </script>
    </div>
  </body>
</html>
